<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drag & Drop HTML Code Builder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --bg: #181a1b;
      --sidebar: #23272e;
      --canvas: #22262a;
      --toolbar: #23272e;
      --text: #f8f8fa;
      --accent: #5ebaf7;
      --accent2: #82e29d;
      --danger: #e36d6d;
      --border: #32373e;
      --shadow: 0 2px 10px rgba(14,22,36,0.15);
    }
    body {
      background: var(--bg);
      color: var(--text);
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      min-height: 100vh;
      height: 100vh;
      overflow: hidden;
    }
    #sidebar {
      width: 230px;
      background: var(--sidebar);
      border-right: 1.5px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 0;
      gap: 10px;
      box-shadow: var(--shadow);
    }
    #sidebar h2 {
      font-size: 19px;
      color: var(--accent);
      margin: 20px 18px 10px 18px;
      letter-spacing: 1px;
      font-weight: 600;
    }
    .component {
      background: #22262a;
      color: var(--text);
      margin: 0 16px 6px 16px;
      padding: 10px 8px;
      border-radius: 8px;
      cursor: grab;
      user-select: none;
      text-align: center;
      font-size: 15.5px;
      border: 1.2px solid var(--border);
      transition: background 0.15s, border 0.18s;
      box-shadow: 0 2px 5px rgba(30,30,60,0.04);
      letter-spacing: 0.1px;
      font-weight: 500;
    }
    .component:active {
      background: #27303a;
      border: 1.5px solid var(--accent);
    }
    #canvas-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      min-height: 0;
    }
    #toolbar {
      background: var(--toolbar);
      border-bottom: 1.5px solid var(--border);
      padding: 14px 22px 14px 30px;
      display: flex;
      align-items: center;
      gap: 20px;
      font-size: 16px;
      font-weight: 500;
      box-shadow: var(--shadow);
    }
    #toolbar .tabs {
      margin-left: auto;
      display: flex;
      gap: 2px;
    }
    .tab-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 15px;
      padding: 8px 18px;
      border-radius: 7px 7px 0 0;
      cursor: pointer;
      transition: background 0.14s;
      font-weight: 500;
      border-bottom: 2.5px solid transparent;
    }
    .tab-btn.active {
      background: var(--canvas);
      color: var(--accent);
      border-bottom: 2.5px solid var(--accent);
    }
    #exportBtn {
      background: var(--accent2);
      color: #23272e;
      border: none;
      padding: 8px 18px;
      border-radius: 5px;
      font-size: 15px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.2px;
      margin-left: 20px;
      transition: background 0.16s;
      box-shadow: 0 1.5px 8px rgba(40,220,120,0.10);
    }
    #exportBtn:hover { background: #b1f1c7; }
    #exportMsg { margin-left: 14px; color: var(--accent2); font-weight: 500; }
    #canvas, #codeView {
      flex: 1;
      background: var(--canvas);
      margin: 0 30px 30px 30px;
      border-radius: 12px;
      margin-top: 15px;
      min-height: 300px;
      padding: 24px 12px 24px 12px;
      transition: border-color 0.2s;
      border: 2.5px dashed var(--accent);
      overflow-y: auto;
      box-shadow: var(--shadow);
    }
    #canvas.canvas-drop-hover { border-color: var(--accent2); }
    #canvas {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      align-content: flex-start;
      min-height: 340px;
    }
    .canvas-item {
      position: relative;
      min-width: 134px;
      min-height: 46px;
      background: #232c34;
      border: 1.5px solid var(--border);
      border-radius: 10px;
      padding: 10px 17px 10px 38px;
      box-shadow: 0 2px 12px rgba(18,28,52,0.07);
      cursor: move;
      display: flex;
      align-items: center;
      font-size: 15.5px;
      color: var(--text);
      margin-bottom: 4px;
      transition: border 0.15s, box-shadow 0.15s;
    }
    .canvas-item.selected { border: 2px solid var(--accent2); }
    .delete-btn {
      position: absolute;
      left: 5px; top: 5px;
      background: var(--danger);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 20px; height: 20px;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 2;
      opacity: 0.78;
      transition: opacity 0.18s;
    }
    .delete-btn:hover { opacity: 1; background: #d44141; }
    .dragging {
      opacity: 0.33 !important;
      border: 2.5px dashed var(--accent);
    }

    /* Property editor */
    #property-editor {
      position: fixed;
      top: 65px;
      right: 40px;
      background: #20272f;
      color: #fff;
      border-radius: 12px;
      border: 1.5px solid var(--border);
      box-shadow: 0 2px 15px #141b22a8;
      min-width: 270px;
      z-index: 9;
      padding: 22px 20px 16px 20px;
      display: none;
      flex-direction: column;
      gap: 16px;
      animation: fadeIn 0.18s;
    }
    #property-editor h3 {
      color: var(--accent2);
      font-size: 17px;
      margin-top: 0;
      margin-bottom: 9px;
    }
    #property-editor label {
      font-size: 14px;
      color: #a7b9c4;
      margin-bottom: 5px;
      display: block;
    }
    #property-editor input, #property-editor select {
      background: #232c34;
      color: #fff;
      border: 1.3px solid var(--border);
      border-radius: 6px;
      padding: 7px 10px;
      font-size: 14px;
      width: 100%;
      margin-bottom: 9px;
      margin-top: 2px;
    }
    #property-editor input[type=checkbox] {
      width: auto;
      margin-right: 8px;
      vertical-align: middle;
    }
    #property-editor .close-prop {
      position: absolute;
      top: 7px; right: 10px;
      background: none;
      border: none;
      color: #e36d6d;
      font-size: 20px;
      cursor: pointer;
      font-weight: 600;
      opacity: 0.8;
      transition: color 0.2s;
    }
    #property-editor .close-prop:hover { color: #ff9898; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px);}
      to { opacity: 1; transform: none;}
    }

    /* Code view */
    #codeView {
      display: none;
      font-family: "Fira Mono", "Consolas", monospace;
      font-size: 15px;
      color: #c4e3fb;
      background: #181e23;
      padding: 22px 18px;
      border-radius: 12px;
      white-space: pre;
      overflow-x: auto;
      min-height: 300px;
      box-shadow: var(--shadow);
      border: 2.2px solid var(--accent2);
    }
    .hl-tag       { color: #7ec3fa; }
    .hl-attr      { color: #87e6b5; }
    .hl-str       { color: #fcd972; }
    .hl-comment   { color: #7a8799; font-style: italic;}
    .hl-plain     { color: #c4e3fb; }

    /* Responsive */
    @media (max-width: 850px) {
      #sidebar { width: 110px; font-size: 12px; }
      #canvas, #codeView { margin: 0 3px 10px 3px; }
      #property-editor { right: 5px; }
    }
    @media (max-width: 600px) {
      #sidebar { display: none; }
      #canvas, #codeView { margin: 0 1vw 8vw 1vw; }
      #property-editor { left: 2vw; right: 2vw; min-width: 90vw;}
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>Palette</h2>
    <div class="component" draggable="true" data-type="image">Image</div>
    <div class="component" draggable="true" data-type="button">Button</div>
    <div class="component" draggable="true" data-type="input">Text Input</div>
    <div class="component" draggable="true" data-type="textarea">Textarea</div>
    <div class="component" draggable="true" data-type="heading">Heading</div>
    <div class="component" draggable="true" data-type="paragraph">Paragraph</div>
    <div class="component" draggable="true" data-type="link">Link</div>
    <div class="component" draggable="true" data-type="card">Card</div>
    <div class="component" draggable="true" data-type="divider">Divider</div>
    <div class="component" draggable="true" data-type="list">List</div>
  </div>
  <div id="canvas-container">
    <div id="toolbar">
      <span>Drag a component onto the canvas, then click it to edit its properties</span>
      <button id="exportBtn">Copy HTML</button>
      <span id="exportMsg"></span>
      <div class="tabs">
        <button class="tab-btn active" id="tab-browser">Browser View</button>
        <button class="tab-btn" id="tab-code">Code View</button>
      </div>
    </div>
    <div id="canvas"></div>
    <pre id="codeView"></pre>
  </div>
  <form id="property-editor"></form>
  <script>
    // --- Component definitions ---
    const components = {
      image: {
        label: "Image",
        icon: "🖼️",
        default: {
          src: "https://placehold.co/200x120",
          alt: "Placeholder Image",
          width: 200,
          height: 120,
          style: "border-radius:8px;border:1.5px solid #444;max-width:100%;"
        },
        html: props => `<img src="${props.src}" alt="${props.alt}" width="${props.width}" height="${props.height}" style="${props.style}">`,
        props: [
          {name: "src", label: "Image URL", type: "text"},
          {name: "alt", label: "Alt Text", type: "text"},
          {name: "width", label: "Width (px)", type: "number"},
          {name: "height", label: "Height (px)", type: "number"},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      button: {
        label: "Button",
        icon: "🔘",
        default: {
          text: "Click Me",
          type: "button",
          style: "padding:9px 22px;border-radius:6px;background:var(--accent);color:#fff;border:none;font-weight:600;font-size:16px;"
        },
        html: props => `<button type="${props.type}" style="${props.style}">${props.text}</button>`,
        props: [
          {name: "text", label: "Button Text", type: "text"},
          {name: "type", label: "Type", type: "select", options: ["button","submit","reset"]},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      input: {
        label: "Text Input",
        icon: "⌨️",
        default: {
          placeholder: "Enter text...",
          value: "",
          style: "padding:8px 13px;border-radius:5px;border:1.5px solid #555;font-size:15px;"
        },
        html: props => `<input type="text" value="${props.value}" placeholder="${props.placeholder}" style="${props.style}">`,
        props: [
          {name: "placeholder", label: "Placeholder", type: "text"},
          {name: "value", label: "Value", type: "text"},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      textarea: {
        label: "Textarea",
        icon: "📄",
        default: {
          placeholder: "Enter multi-line text...",
          value: "",
          rows: 4,
          style: "padding:8px 13px;border-radius:5px;border:1.5px solid #555;font-size:15px;min-width:160px;"
        },
        html: props => `<textarea rows="${props.rows}" placeholder="${props.placeholder}" style="${props.style}">${props.value}</textarea>`,
        props: [
          {name: "placeholder", label: "Placeholder", type: "text"},
          {name: "value", label: "Value", type: "text"},
          {name: "rows", label: "Rows", type: "number"},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      heading: {
        label: "Heading",
        icon: "📰",
        default: {
          text: "Heading",
          level: "h2",
          style: "margin:0 0 8px 0;color:var(--accent);font-weight:700;"
        },
        html: props => `<${props.level} style="${props.style}">${props.text}</${props.level}>`,
        props: [
          {name: "text", label: "Text", type: "text"},
          {name: "level", label: "Level", type: "select", options: ["h1","h2","h3","h4"]},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      paragraph: {
        label: "Paragraph",
        icon: "📑",
        default: {
          text: "This is a paragraph. Replace with your content.",
          style: "margin:0 0 8px 0;font-size:16px;line-height:1.6;color:#d4f0ff;"
        },
        html: props => `<p style="${props.style}">${props.text}</p>`,
        props: [
          {name: "text", label: "Text", type: "text"},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      link: {
        label: "Link",
        icon: "🔗",
        default: {
          href: "https://github.com/",
          text: "Visit GitHub",
          target: "_blank",
          style: "color:var(--accent);font-weight:500;text-decoration:underline;"
        },
        html: props => `<a href="${props.href}" target="${props.target}" style="${props.style}">${props.text}</a>`,
        props: [
          {name: "href", label: "URL", type: "text"},
          {name: "text", label: "Text", type: "text"},
          {name: "target", label: "Open In", type: "select", options: [
            {value: "_blank", label: "New Tab"},
            {value: "_self", label: "Same Tab"}
          ]},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      card: {
        label: "Card",
        icon: "🗂️",
        default: {
          title: "Card Title",
          content: "Card content goes here.",
          style: "background:#1b2630;border-radius:10px;border:1.5px solid #444;padding:18px 16px;width:180px;box-shadow:0 3px 14px #0e1724a2;color:#fff;"
        },
        html: props => `<div style="${props.style}"><b>${props.title}</b><br><span style="font-size:14px;color:#b8dcff;">${props.content}</span></div>`,
        props: [
          {name: "title", label: "Title", type: "text"},
          {name: "content", label: "Content", type: "text"},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      divider: {
        label: "Divider",
        icon: "➖",
        default: {
          style: "border:none;border-top:2px solid var(--accent2);margin:13px 0 13px 0;"
        },
        html: props => `<hr style="${props.style}">`,
        props: [
          {name: "style", label: "CSS Style", type: "text"}
        ]
      },
      list: {
        label: "List",
        icon: "📋",
        default: {
          items: "First item\nSecond item\nThird item",
          ordered: false,
          style: "margin:0 0 8px 20px;font-size:16px;"
        },
        html: props => {
          const tag = props.ordered ? "ol" : "ul";
          return `<${tag} style="${props.style}">${props.items
            .split('\n').map(it=>it.trim()).filter(Boolean).map(it=>`<li>${it}</li>`).join('')}</${tag}>`;
        },
        props: [
          {name: "items", label: "List Items (one per line)", type: "textarea"},
          {name: "ordered", label: "Ordered", type: "checkbox"},
          {name: "style", label: "CSS Style", type: "text"}
        ]
      }
    };

    // --- Data model ---
    let canvasData = []; // [{type, props}]
    let draggedSidebarType = null;
    let draggedCanvasElem = null;
    let dragStartIndex = null;
    let selectedIndex = null;

    // --- Sidebar drag ---
    document.querySelectorAll('.component').forEach(comp => {
      comp.addEventListener('dragstart', e => {
        draggedSidebarType = comp.getAttribute('data-type');
        e.dataTransfer.effectAllowed = 'copy';
      });
      comp.addEventListener('dragend', e => {
        draggedSidebarType = null;
      });
    });

    // --- Canvas drop logic ---
    const canvas = document.getElementById('canvas');

    canvas.addEventListener('dragover', e => {
      e.preventDefault();
      canvas.classList.add('canvas-drop-hover');
      e.dataTransfer.dropEffect = draggedSidebarType ? 'copy' : 'move';
    });
    canvas.addEventListener('dragleave', e => {
      canvas.classList.remove('canvas-drop-hover');
    });
    canvas.addEventListener('drop', e => {
      e.preventDefault();
      canvas.classList.remove('canvas-drop-hover');
      // Find insert position
      const y = e.clientY;
      let insertAt = canvasData.length;
      Array.from(canvas.children).forEach((child, idx) => {
        if (y < child.getBoundingClientRect().top + child.offsetHeight/2) {
          insertAt = idx;
          return;
        }
      });
      if (draggedSidebarType) {
        // New component
        const type = draggedSidebarType;
        const props = {...components[type].default};
        canvasData.splice(insertAt, 0, {type, props});
        selectedIndex = insertAt;
        renderCanvas();
        showPropertyEditor(selectedIndex);
      } else if (draggedCanvasElem) {
        // Reorder
        const from = parseInt(draggedCanvasElem.dataset.idx);
        if (from === insertAt || from+1 === insertAt) return;
        const [item] = canvasData.splice(from, 1);
        if (insertAt > from) insertAt--;
        canvasData.splice(insertAt, 0, item);
        selectedIndex = insertAt;
        renderCanvas();
        showPropertyEditor(selectedIndex);
      }
      draggedSidebarType = null;
      draggedCanvasElem = null;
    });

    // --- Render functions ---
    function renderCanvas() {
      canvas.innerHTML = '';
      canvasData.forEach((item, idx) => {
        const outer = document.createElement('div');
        outer.className = 'canvas-item';
        outer.dataset.idx = idx;
        if (idx === selectedIndex) outer.classList.add('selected');
        outer.innerHTML = `
          <button class="delete-btn" title="Delete">&times;</button>
          ${components[item.type].html(item.props)}
        `;
        // Drag logic
        outer.setAttribute('draggable', 'true');
        outer.addEventListener('dragstart', e => {
          draggedCanvasElem = outer;
          dragStartIndex = idx;
          setTimeout(() => outer.classList.add('dragging'), 0);
        });
        outer.addEventListener('dragend', e => {
          outer.classList.remove('dragging');
          draggedCanvasElem = null;
        });
        // Delete logic
        outer.querySelector('.delete-btn').onclick = e => {
          e.stopPropagation();
          canvasData.splice(idx,1);
          if(selectedIndex === idx) selectedIndex = null;
          renderCanvas();
          hidePropertyEditor();
        };
        // Select logic
        outer.addEventListener('click', e => {
          selectedIndex = idx;
          renderCanvas();
          showPropertyEditor(idx);
        });
        canvas.appendChild(outer);
      });
      updateCodeView();
    }

    // --- Property Editor ---
    const propEditor = document.getElementById('property-editor');

    function showPropertyEditor(idx) {
      if (idx == null || !canvasData[idx]) return hidePropertyEditor();
      const item = canvasData[idx];
      const meta = components[item.type];
      propEditor.innerHTML = `<button class="close-prop" title="Close">&times;</button><h3>Edit ${meta.label}</h3>`;
      meta.props.forEach(field => {
        const val = item.props[field.name];
        let input;
        if (field.type === "text") {
          input = `<input type="text" name="${field.name}" value="${val || ""}">`;
        } else if (field.type === "number") {
          input = `<input type="number" name="${field.name}" value="${val || ""}">`;
        } else if (field.type === "select") {
          let options = "";
          (field.options || []).forEach(opt => {
            if(typeof opt === "string") opt = {value:opt, label:opt.toUpperCase()};
            options += `<option value="${opt.value||opt}">${opt.label||opt.value||opt}</option>`;
          });
          input = `<select name="${field.name}">${options}</select>`;
        } else if (field.type === "checkbox") {
          input = `<input type="checkbox" name="${field.name}" ${val ? "checked" : ""}>`;
        } else if (field.type === "textarea") {
          input = `<textarea name="${field.name}" rows="3">${val||""}</textarea>`;
        }
        propEditor.innerHTML += `<label>${field.label}</label>${input}`;
      });
      propEditor.style.display = "flex";
      propEditor.style.top = window.innerWidth < 600 ? "4vw" : "65px";
      // Set initial values for selects
      meta.props.forEach(field => {
        if (field.type === "select") {
          propEditor.elements[field.name].value = item.props[field.name];
        }
      });
      // Handler
      propEditor.oninput = function(e) {
        const {name, type} = e.target;
        if(type==="checkbox") item.props[name] = e.target.checked;
        else item.props[name] = e.target.value;
        renderCanvas();
        showPropertyEditor(idx);
      };
      propEditor.querySelector('.close-prop').onclick = hidePropertyEditor;
    }
    function hidePropertyEditor() { propEditor.style.display="none"; selectedIndex = null; renderCanvas(); }

    // --- Export logic ---
    document.getElementById('exportBtn').onclick = () => {
      const html = getExportHtml();
      copyTextToClipboard(html);
      document.getElementById('exportMsg').textContent = "Copied to clipboard!";
      setTimeout(()=>document.getElementById('exportMsg').textContent=" ", 1900);
    };
    function getExportHtml() {
      return canvasData.map(item => components[item.type].html(item.props)).join('\n');
    }
    function copyTextToClipboard(text) {
      if (navigator.clipboard) navigator.clipboard.writeText(text);
      else {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        textarea.remove();
      }
    }

    // --- Tabs logic ---
    const tabBrowser = document.getElementById('tab-browser');
    const tabCode = document.getElementById('tab-code');
    const codeView = document.getElementById('codeView');
    tabBrowser.onclick = () => {
      tabBrowser.classList.add('active');
      tabCode.classList.remove('active');
      canvas.style.display = "";
      codeView.style.display = "none";
      hidePropertyEditor();
    };
    tabCode.onclick = () => {
      tabCode.classList.add('active');
      tabBrowser.classList.remove('active');
      canvas.style.display = "none";
      codeView.style.display = "";
      hidePropertyEditor();
      updateCodeView();
    };

    // --- HTML syntax highlight ---
    function updateCodeView() {
      let code = getExportHtml();
      codeView.innerHTML = syntaxHighlightHtml(code);
    }
    function syntaxHighlightHtml(html) {
      // Very simple HTML syntax highlighter
      return html.replace(/<!--[\s\S]*?-->/g, m => `<span class="hl-comment">${m}</span>`).replace(/(&lt;|<)(\/?)([\w-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:'[^']*'|"[^"]*"|[^\s"'=<>`\\]+))?)*)\s*(\/?)(&gt;|>)/g,
          (m, lt, slash, tag, attrs, selfclose, gt) =>
            `<span class="hl-tag">${lt}${slash}${tag}</span>${attrs.replace(/([\w:-]+)(\s*=\s*)("[^"]*"|'[^']*'|[^\s"'=<>`\\]+)?/g,
            (m, attr, eq, val) => `<span class="hl-attr"> ${attr}</span>${eq?'<span class="hl-plain">'+eq+'</span>':''}${val?'<span class="hl-str">'+val+'</span>':''}`)}<span class="hl-tag">${selfclose}${gt}</span>`
    );
    }

    // --- Deselect property editor on background click ---
    canvas.addEventListener('click', e => {
      if(e.target === canvas) hidePropertyEditor();
    });

    // --- Keyboard shortcuts for delete ---
    window.addEventListener('keydown', e => {
      if ((e.key === "Delete" || e.key === "Backspace") && selectedIndex != null) {
        canvasData.splice(selectedIndex, 1);
        hidePropertyEditor();
        renderCanvas();
      }
    });

    // --- Initial render ---
    renderCanvas();

    // --- Responsive: Move property editor if overflow ---
    window.addEventListener('resize', ()=>{
      if(propEditor.style.display==='flex'){
        propEditor.style.top = window.innerWidth < 600 ? "4vw" : "65px";
      }
    });

  </script>
</body>
</html>